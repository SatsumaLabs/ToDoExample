# Javascript Node CircleCI 2.0 configuration file
#
# Check https://circleci.com/docs/2.0/language-javascript/ for more details
#
version: 2
jobs:
  build:
    docker:
      # - image: docker:17.05.0-ce-git
      - image: google/cloud-sdk

    working_directory: ~/repo

    steps:
      - run:
          name: Configure GCloud
          command: |
            echo $GCLOUD_SERVICE_KEY | gcloud auth activate-service-account --key-file=-
            gcloud --quiet config set project ${GOOGLE_PROJECT_ID}
            gcloud --quiet config set compute/zone ${GOOGLE_COMPUTE_ZONE}

      - checkout
      - setup_remote_docker

      - run:
          name: Install Dependencies
          command: |
            echo Installing Dependencies...

      - run:
          name: Build Docker Image
          command: |
            docker build -t us.gcr.io/${GOOGLE_PROJECT_ID}/todoclient:${CIRCLE_SHA1} .

      - run:
          name: Push Docker Image to GCR
          command: |
            gcloud auth configure-docker
            docker push us.gcr.io/${GOOGLE_PROJECT_ID}/todoclient:${CIRCLE_SHA1}
